id: openspec.runtime.validation.v1
name: Runtime Functional & Semantic Validation
status: active
scope: production
category: validation
owner: SmarterOS
description: >
  Especificación para validación continua de integridad funcional,
  enlaces críticos, estructura de URLs y variaciones semánticas en
  sitios productivos de clientes.

frequency:
  default: daily
  minimum: hourly
  maximum: weekly

targets:
  domain:
    required: true
  critical_urls:
    required: true
    examples:
      - /
      - /catalogo
      - /producto/*
      - /checkout
      - /contacto
      - /terminos
  allowed_domains:
    scope: internal_only
    allow_external: false

link_validation:
  enabled: true
  checks:
    - status_code
    - redirect_target
    - domain_escape
  allowed_status:
    - 200
    - 301
  blocked_status:
    - 404
    - 500
  severity:
    critical: [404, 500]
    relevant: [301]
    minor: []

url_delta_detection:
  enabled: true
  track:
    - new_urls
    - removed_urls
    - modified_urls
  notify_on:
    - new_urls
    - removed_urls

semantic_validation:
  enabled: true
  extract:
    - headings
    - buttons
    - primary_copy
    - prices
    - payment_methods
  expected_keywords:
    required: []
  sensitive_keywords:
    examples:
      - precio
      - oferta
      - descuento
      - transferencia
      - tarjeta
      - suscripción
      - flow
      - mercadopago
      - webpay
  llm_provider: openrouter
  impact_levels:
    - minor
    - relevant
    - critical

comparison:
  baseline: previous_execution
  diff_engine: semantic+structural

alerts:
  enabled: true
  channels:
    email:
      provider: mailgun
    webhook:
      target: mcp
  notify_on:
    - critical_link_failure
    - checkout_unreachable
    - sensitive_word_change
    - new_funnel_detected
    - payment_method_removed

storage:
  provider: supabase
  retention:
    raw_snapshots_days: 90
    diffs_days: 180
    alerts_days: 365

compliance:
  sla_enforced: true
  breach_conditions:
    - checkout_down
    - payment_method_removed
    - legal_page_missing

outputs:
  - functional_status
  - link_integrity_score
  - semantic_delta_score
  - commercial_risk_level

security:
  execution_isolated: true
  pii_collection: false

versioning:
  strategy: semantic
  current: v1.0.0

integration:
  tools:
    scraping: firecrawl
    llm: openrouter
    storage: supabase
    email: mailgun
    orchestration: n8n
  
chile_specifics:
  payment_methods:
    - webpay
    - flow
    - mercadopago
    - khipu
  legal_pages:
    - /terminos
    - /privacidad
    - /politica-devolucion
  compliance:
    - ley_19628
    - sernac
