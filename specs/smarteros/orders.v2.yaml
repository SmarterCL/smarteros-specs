# specs/smarteros/orders.v2.yaml
# OpenSpec v2 for Order entity with multimodal support
entity: order
description: "Order entity for SmarterOS platform with multimodal capabilities"
tenant_isolated: true
fields:
  id:
    type: string
    required: true
    primary: true
    description: "Unique order identifier"
  customer_id:
    type: string
    required: true
    description: "Foreign key to customer"
  order_number:
    type: string
    required: true
    unique: true
    description: "Order number (e.g. ORD-2025-001)"
  status:
    type: string
    required: true
    default: "pending"
    enum: ["pending", "processing", "shipped", "delivered", "cancelled", "refunded"]
    description: "Order status"
  total_amount:
    type: number
    required: true
    description: "Total order amount"
  currency:
    type: string
    required: true
    default: "CLP"
    description: "Currency code (e.g. CLP, USD)"
  items:
    type: array
    required: true
    description: "Array of order items"
  attachments:
    type: array
    items:
      type: file
    required: false
    description: "Order-related attachments (invoices, receipts, etc.)"
  images:
    type: array
    items:
      type: image
    required: false
    description: "Order-related images"
  notes:
    type: string
    required: false
    description: "Order notes or comments"
  created_at:
    type: timestamp
    required: true
    description: "Order creation timestamp"
  updated_at:
    type: timestamp
    required: true
    description: "Last update timestamp"
  tenant_id:
    type: string
    required: true
    description: "Tenant identifier for multi-tenant isolation"
ingestion:
  multimodal:
    enabled: true
    supported_types: ["image", "file", "document", "url"]
    auto_processors:
      - type: "image"
        action: "validate_and_resize"
      - type: "file"
        action: "virus_scan"
      - type: "document"
        action: "text_extraction"
      - type: "url"
        action: "metadata_scraping"
events:
  created:
    description: "Triggered when an order is created"
    payload:
      - order_id
      - customer_id
      - total_amount
      - tenant_id
  attachment_uploaded:
    description: "Triggered when an attachment is uploaded to order"
    payload:
      - order_id
      - attachment_type
      - attachment_url
      - tenant_id
  image_uploaded:
    description: "Triggered when an image is uploaded to order"
    payload:
      - order_id
      - image_url
      - tenant_id
  status_changed:
    description: "Triggered when order status changes"
    payload:
      - order_id
      - old_status
      - new_status
      - tenant_id
  payment_received:
    description: "Triggered when payment is received"
    payload:
      - order_id
      - amount
      - payment_method
      - tenant_id
  shipped:
    description: "Triggered when order is shipped"
    payload:
      - order_id
      - tracking_number
      - tenant_id
validation:
  rules:
    - field: total_amount
      type: positive_number
      required: true
    - field: status
      type: enum
      values: ["pending", "processing", "shipped", "delivered", "cancelled", "refunded"]
      required: true
    - field: attachments
      type: file_array
      maxItems: 5
      maxSizePerItem: "25MB"
      formats: ["pdf", "jpg", "png", "gif", "zip"]
      required: false
    - field: images
      type: image_array
      maxItems: 10
      maxSizePerItem: "5MB"
      formats: ["jpg", "jpeg", "png", "webp"]
      required: false
relationships:
  customer:
    type: many-to-one
    entity: customer
    foreign_key: customer_id