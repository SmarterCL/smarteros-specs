# specs/smarteros/customers.v2.yaml
# OpenSpec v2 for Customer entity with multimodal support
entity: customer
description: "Customer entity for SmarterOS platform with multimodal capabilities"
tenant_isolated: true
fields:
  id:
    type: string
    required: true
    primary: true
    description: "Unique customer identifier"
  rut:
    type: string
    required: true
    unique: true
    description: "Chilean tax identification number"
  name:
    type: string
    required: true
    description: "Customer's full name"
  whatsapp:
    type: string
    required: false
    description: "WhatsApp number in E.164 format"
  email:
    type: string
    required: false
    unique: true
    description: "Customer email address"
  phone:
    type: string
    required: false
    description: "Phone number in E.164 format"
  company:
    type: string
    required: false
    description: "Company name if business customer"
  avatar:
    type: image
    required: false
    description: "Customer avatar/image"
  documents:
    type: array
    items:
      type: document
    required: false
    description: "Customer documents/attachments"
  status:
    type: string
    required: true
    default: "active"
    enum: ["active", "inactive", "suspended", "demo"]
    description: "Customer status"
  created_at:
    type: timestamp
    required: true
    description: "Creation timestamp"
  updated_at:
    type: timestamp
    required: true
    description: "Last update timestamp"
  tenant_id:
    type: string
    required: true
    description: "Tenant identifier for multi-tenant isolation"
ingestion:
  multimodal:
    enabled: true
    supported_types: ["image", "document", "url"]
    auto_processors:
      - type: "image"
        action: "validate_and_resize"
      - type: "document" 
        action: "text_extraction"
      - type: "url"
        action: "metadata_scraping"
events:
  created:
    description: "Triggered when a customer is created"
    payload:
      - customer_id
      - rut
      - name
      - tenant_id
  updated:
    description: "Triggered when a customer is updated"
    payload:
      - customer_id
      - updated_fields
      - tenant_id
  document_uploaded:
    description: "Triggered when customer uploads a document"
    payload:
      - customer_id
      - document_type
      - document_url
      - tenant_id
  avatar_updated:
    description: "Triggered when customer avatar is updated" 
    payload:
      - customer_id
      - avatar_url
      - tenant_id
validation:
  rules:
    - field: rut
      type: chilean_rut
      required: true
    - field: whatsapp
      type: phone_e164
      required: false
    - field: email
      type: email
      required: false
    - field: avatar
      type: image
      maxSize: "5MB"
      formats: ["jpg", "jpeg", "png", "webp"]
      required: false
    - field: documents
      type: document_array
      maxItems: 10
      maxSizePerItem: "20MB"
      formats: ["pdf", "doc", "docx", "jpg", "png"]
      required: false
relationships:
  orders:
    type: one-to-many
    entity: order
    foreign_key: customer_id