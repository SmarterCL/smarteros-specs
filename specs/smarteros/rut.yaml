# specs/smarteros/rut.yaml
# OpenSpec for RUT (Rol Ãšnico Tributario) entity
entity: rut
description: "Chilean tax identification system"
tenant_isolated: true
fields:
  id:
    type: string
    required: true
    primary: true
    description: "Unique RUT identifier"
  rut_number:
    type: string
    required: true
    unique: true
    description: "RUT number without verification digit (e.g. 12345678)"
  verification_digit:
    type: string
    required: true
    description: "Verification digit (0-9 or K)"
  full_rut:
    type: string
    required: true
    unique: true
    description: "Full RUT in format: 12345678-9 or 12345678-K"
  entity_type:
    type: string
    required: true
    enum: ["person", "company"]
    description: "Type of entity (individual or company)"
  name:
    type: string
    required: true
    description: "Entity name"
  status:
    type: string
    required: true
    default: "active"
    enum: ["active", "inactive", "suspended"]
    description: "RUT status in SII system"
  created_at:
    type: timestamp
    required: true
    description: "Registration timestamp"
  updated_at:
    type: timestamp
    required: true
    description: "Last update timestamp"
  tenant_id:
    type: string
    required: true
    description: "Tenant identifier for multi-tenant isolation"
events:
  validated:
    description: "Triggered when RUT is validated against SII"
    payload:
      - rut
      - validation_result
      - tenant_id
  created:
    description: "Triggered when RUT record is created"
    payload:
      - rut
      - entity_type
      - tenant_id
validation:
  rules:
    - field: full_rut
      type: chilean_rut_format
      required: true
    - field: rut_number
      type: numeric_only
      required: true
    - field: verification_digit
      type: chilean_rut_verification
      required: true
relationships:
  customers:
    type: one-to-many
    entity: customer
    foreign_key: rut